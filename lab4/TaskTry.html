<!-- CSE 5542 Lab3 Task2-4 -->
<!-- Jiaxin Yang.5039@osu.edu -->

<!DOCTYPE html>
<html>
  <head>
    <title>Lab_3</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <style></style>
  </head>

  <body>
    <svg width="1000" height="2000"></svg>

    <script type="text/javascript">
      // TASK 2 - D3 Choropleth Map with bonus
      // Load external data and boot
      var data = d3.map();
      d3.queue()
        .defer(d3.json, "us-states.json")
        .defer(d3.csv, "state_Gen.csv", function (d) {
          data.set(d.STATE_CODE, +d.GENERATION);
        })
        .await(ready);

      function ready(error, topo) {
        var doma = [
          0, 50000000, 100000000, 150000000, 200000000, 250000000, 300000000,
          350000000, 400000000, 450000000, 500000000,
        ];
        var colorScale = d3
          .scaleThreshold()
          .domain(doma)
          .range(d3.schemeBlues[7]);

        // Map and projection
        var path = d3.geoPath();
        var projection = d3.geoAlbersUsa();

        let mouseOver = function (d) {
          d3.selectAll(".State")
            .transition()
            .duration(200)
            .style("opacity", 0.7);
          d3.select(this).transition().duration(200).style("opacity", 1);
        };

        let mouseLeave = function (d) {
          d3.selectAll(".State").transition().duration(200).style("opacity", 1);
          // d3.select(this).transition().duration(200);
        };

        // Draw the map
        d3.select("svg")
          .append("g")
          .attr("transform", "translate(0, 100)")
          .selectAll("path")
          .data(topo.features)
          .enter()
          .append("path")
          // draw each State
          .attr("d", d3.geoPath().projection(projection))
          // set the color of each State
          .attr("fill", function (d) {
            d.total = data.get(d.id) || 0;
            return colorScale(d.total);
          })
          .style("stroke", "grey")
          .attr("class", function (d) {
            return "State";
          })
          .on("mouseover", mouseOver)
          .on("mouseleave", mouseLeave);

        d3.select("svg")
          .append("g")
          // title
          .append("text")
          .text("2021 Electricity Generation on Map")
          .attr("transform", "translate(300, 100)");
        }
    </script>
  </body>
</html>
